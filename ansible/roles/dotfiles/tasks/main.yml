---
# dotfiles playbook

- name: "Clone dotfiles"
  git: repo=https://mjwalf@bitbucket.org/mjwalf/dotfiles.git dest=/Users/{{install_user}}/.dotfiles recursive=yes

- name: "Link files"
  file: src=/Users/{{install_user}}/.dotfiles/{{ item.path }} dest=/Users/{{install_user}}/{{ item.dest }} state=link
  with_items:
    - { path: "tmux.conf", dest: ".tmux.conf" }
    - { path: "gitconfig", dest: ".gitconfig" }
    - { path: "zsh/zshrc", dest: ".zshrc" }

- name: "Link secrets" #TODO change to secure location
  file: src=/Users/{{install_user}}/Documents/{{ item.path }} dest=/Users/{{install_user}}/{{ item.dest }} state=link force=yes
  with_items:
    - { path: ".dotfiles/.common_env", dest: ".common_env" }
    - { path: ".dotfiles/.localsecrets", dest: ".localsecrets" }

- name: "Clone oh-my-zsh robbyrussell"
  git: repo=https://github.com/robbyrussell/oh-my-zsh.git dest=/Users/{{install_user}}/oh-my-zsh recursive=yes

- name: "Link oh-my-zsh"
  file: src=/Users/{{install_user}}/{{ item.path }} dest=/Users/{{install_user}}/{{ item.dest }} state=link
  with_items:
    - { path: "oh-my-zsh", dest: ".oh-my-zsh" }

- name: "Install font"
  file: src="/Users/{{install_user}}/.dotfiles/fonts/Droid Sans Mono for Powerline.otf" dest="/Users/{{install_user}}/Library/Fonts/Droid Sans Mono for Powerline.otf" state=link

- name: "add shell"
  lineinfile: dest=/etc/shells line='/usr/local/bin/zsh'
  become: true

- name: "change shell"
  command: chsh -s /usr/local/bin/zsh "{{install_user}}"
  become: true
